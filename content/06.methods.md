## STAR METHODS

### RESOURCE AVAILABILITY

#### Lead contact

Requests for access to OpenPBTA raw data and/or specimens may be directed to, and will be fulfilled by Jo Lynne Rokita (rokita@chop.edu).

#### Materials availability

This study did not create new, unique reagents.

#### Data and code availability

Raw and harmonized WGS, WXS, and RNA-Seq data derived from human samples are available within the KidsFirst Portal [@doi:10.24370/OPENPBTA] upon access request to the CBTN (https://cbtn.org/) as of the date of the publication.
In addition, merged summary files are openly accessible at https://cavatica.sbgenomics.com/u/cavatica/openpbta or via download script from https://github.com/AlexsLemonade/OpenPBTA-analysis/.
Summary data are visible within PedcBioPortal at https://pedcbioportal.kidsfirstdrc.org/study/summary?id=openpbta.
Links or DOIs are listed in the **Key Resources Table**.
<!-- TODO: create data dois -->

All original code has been deposited in the following repositories and is publicly available as of the date of the publication:
- Primary data analyses: https://github.com/d3b-center/OpenPBTA-workflows/
- Downstream data analyses: https://github.com/AlexsLemonade/OpenPBTA-analysis/
- Manuscript code: https://github.com/AlexsLemonade/OpenPBTA-manuscript
Links or DOIs are listed in the **Key Resources Table**.
<!-- TODO: create code dois -->

Any additional information required to reanalyze the data reported in this paper is available
from the lead contact upon request.

### METHOD DETAILS

#### Biospecimen Collection

The Pediatric Brain Tumor Atlas specimens are comprised of samples from Children's Brain Tumor Network (CBTN) and the Pediatric Pacific Neuro-Oncology Consortium (PNOC).
The CBTN [@url:https://CBTN.org] is a collaborative, multi-institutional (26 institutions worldwide) research program dedicated to the study of childhood brain tumors.
PNOC [@url:https://www.pnoc.us/] is an international consortium dedicated to bringing new therapies to children and young adults with brain tumors.
We also include blood and tumor biospecimens from newly-diagnosed diffuse intrinsic pontine glioma (DIPG) patients as part of the PNOC003 clinical trial [PNOC003/NCT02274987](https://clinicaltrials.gov/ct2/show/NCT02274987) [@doi:10.1002/ijc.32258].

All CBTN data can be download from the Gabriella Miller Kids First Data Resource Center [@url:https://kidsfirstdrc.org].

The CBTN generated cell lines from either fresh tumor tissue obtained directly from surgery performed at Children’s Hospital of Philadelphia (CHOP) or from prospectively collected tumor specimens stored in Recover Cell Culture Freezing medium (cat# 12648010, Gibco).
Tumor tissue was dissociated using enzymatic method with papain as described [@doi:10.1101/656587].
Briefly, tissue was washed with HBSS (cat# 14175095, Gibco), minced and incubated with activated papain solution (cat# LS003124, SciQuest) for up to 45 minutes.
The papain was inactivated using ovomucoid solution (cat# 542000, SciQuest), tissue was briefly treated with DNase (cat#  10104159001, Roche), and passed through the 100μm cell strainer (cat# 542000, Greiner Bio-One).
Two cell culture conditions were initiated based on the number of cells available.
For cultures utilizing the fetal bovine serum (FBS), a minimum density of 3×10<sup>5</sup> cells/mL were plated in DMEM/F-12 medium (cat# D8062, Sigma) supplemented with 20% FBS (cat# SH30910.03, Hyclone), 1% GlutaMAX (cat# 35050061, Gibco), Penicillin/Streptomycin-Amphotericin B Mixture (cat# 17-745E, Lonza), and 0.2% Normocin (cat# ant-nr-2, Invivogen).
For serum-free media conditions, cells were plated at minimum density of 1×10<sup>6</sup> cells/mL in DMEM/F12 medium supplemented with 1% GlutaMAX, 1X B-27 supplement minus vitamin A (cat# 12587-010, Gibco), 1x N-2 supplement (cat# 17502001, Gibco), 20 ng/ml epidermal growth factor (cat# PHG0311L, Gibco), 20 ng/mL basic fibroblast growth factor (cat# 100-18B, PeproTech), 2.5μg/mL heparin (cat# H3149, Sigma), Penicillin/Streptomycin-Amphotericin B Mixture, and 0.2% Normocin.

#### Nucleic acids extraction and library preparation

##### PNOC samples

The Translational Genomic Research Institute (TGEN; Phoenix, AZ) performed DNA and RNA extractions on tumor biopsies using a DNA/RNA AllPrep Kit (Qiagen, #80204).
All RNA used for library prep had a minimum RIN of 7 but no QC thresholds were implemented for the DNA.
For library preparation, 500 ng of nucleic acids were used as input for RNA-Seq, WXS, and targeted DNA panel  (panel) sequencing.
RNA library preparation was performed using the TruSeq RNA Sample Prep Kit (Illumina, #FC-122-1001) and the exome prep was performed using KAPA Library Preparation Kit (Roche, #KK8201) using Agilent's SureSelect Human All Exon V5 backbone with custom probes.
The targeted DNA panel developed by Ashion (formerly known as the GEM Cancer panel) consisted of exonic probes against 541 cancer genes.
Both panel and WXS assays contained 44,000 probes across evenly spaced genomic loci used for genome-wide copy number analysis.
For the panel, additional probes tiled across intronic regions of 22 known tumor suppressor genes and 22 genes involved in common cancer translocations for structural analysis.
All extractions and library preparations were performed according to manufacturer's instructions.

##### CBTN samples

Blood, tissue, and cell line DNA/RNA extractions were performed at the Biorepository Core at CHOP.
Briefly, 10-20 mg frozen tissue, 0.4-1ml of blood or 2×10^6 cells pellet was used for extractions.
Tissues were lysed using a Qiagen TissueLyser II (Qiagen) with 2×30 sec at 18Hz settings using 5 mm steel beads (cat# 69989, Qiagen).
Both tissue and cell pellets processes included a CHCl3 extraction and were run on the QIACube automated platform (Qiagen) using the AllPrep DNA/RNA/miRNA Universal kit (cat# 80224, Qiagen).
Blood was thawed and treated with RNase A (cat#, 19101, Qiagen); 0.4-1ml was processed using the Qiagen QIAsymphony automated platform (Qiagen) using the QIAsymphony DSP DNA Midi Kit (cat# 937255, Qiagen).
DNA and RNA quantity and quality was assessed by PerkinElmer DropletQuant UV-VIS spectrophotometer (PerkinElmer) and an Agilent 4200 TapeStation (Agilent, USA) for RIN and DIN (RNA Integrity Number and DNA Integrity Number, respectively).
Library preparation and sequencing was performed by the NantHealth Sequencing Center, BGI at CHOP, or the Genomic Clinical Core at Sidra Medical and Research Center.
Briefly, DNA sequencing libraries were prepared for tumor and matched-normal DNA using the KAPA HyperPrep kit (cat# 08098107702, Roche); tumor RNA-Seq libraries were prepared using KAPA Stranded RNA-Seq with RiboErase kit (cat# 07962304001, Roche).

#### Data generation

NantHealth and Sidra performed 2x150 bp WGS on paired tumor (~60X) and constitutive (~30X) DNA samples on an Illumina X/400.
BGI at CHOP performed 2x100 bp WGS sequenced at 60X depth for both tumor and normal samples.
NantHealth performed ribosomal-depleted whole transcriptome stranded RNA-Seq to an average depth of 200M.
BGI at CHOP performed poly-A or ribosomal-depleted whole transcriptome stranded RNA-Seq to an average depth of 100M.
The Translational Genomic Research Institute (TGEN; Phoenix, AZ) performed paired tumor (~200X) and constitutive whole exome sequencing (WXS) or targeted DNA panel (panel) and poly-A selected RNA-Seq (~200M reads) for  PNOC tumor samples.
The panel tumor sample was sequenced to 470X and the normal panel sample was sequenced to 308X.
PNOC 2x100 bp WXS and RNA-Seq libraries were sequenced on an Illumina HiSeq 2500.

#### DNA WGS Alignment

We used BWA-MEM [@arxiv:1303.3997] v0.7.17 to align paired-end DNA-seq reads to the version 38, patch release 12 of the _Homo sapiens_ genome reference, obtained as a FASTA file from UCSC [@url:http://hgdownload.soe.ucsc.edu/goldenPath/hg38/bigZips/].
Next, we used the Broad Institute's Best Practices [@url:https://software.broadinstitute.org/gatk/best-practices/workflow?id=11165] to process Binary Alignment/Map files (BAMs) in preparation for variant discovery.
Duplicates were marked using SAMBLASTER [@doi:10/f6kft3] v0.1.24, and BAMs were merged and sorted using Sambamba [@doi:10/gfzsfw] v0.6.3.
Resultant BAMs were processing using Broad's Genome Analysis Tool Kit [GATK] (https://software.broadinstitute.org/gatk/) v4.0.3.0, BaseRecalibrator submodule.
Lastly, for normal/germline input, we ran the GATK HaplotypeCaller [@doi:10.1101/201178] submodule on the recalibrated BAM to generate a genomic variant call format (GVCF) file.
This file is used as the basis for germline calling, described in the **SNV calling for B-allele Frequency (BAF) generation** section.
References were obtained from the [Broad Genome References on AWS](https://s3.console.aws.amazon.com/s3/buckets/broad-references/hg38/v0/) bucket with a general description of references here [@url:https://s3.amazonaws.com/broad-references/broad-references-readme.html].

#### Quality Control of Sequencing Data

To confirm sample matches and remove mis-matched samples from the dataset, we performed NGSCheckmate [@doi:10.1093/nar/gkx193] on matched tumor/normal CRAM files. 
Briefly, we processed CRAMs using BCFtools to filter and call 20k common single nucleotide polymorphisms (SNPs) using default parameters [@url:https://github.com/parklab/NGSCheckMate]. 
The resulting VCFs were used to run NGSCheckmate following [this workflow](https://github.com/d3b-center/ngs_checkmate_wf) found in the D3b GitHub repository.
Per author recommendations, we used <= 0.61 as a correlation coefficient cutoff at sequencing depths > 10 to predict mis-matched samples.
For RNA-Seq, we determined read strandedness by running the [`infer_experiment.py` script](http://rseqc.sourceforge.net/#infer-experiment-py) on the first 200k mapped reads.
If calculated strandedness did not match strandedness information received from the sequencing center, samples were removed from analysis.
We required at least 60% of RNA-Seq reads mapped to the human reference before samples were removed from analysis.

#### Germline Variant Calling

##### SNP calling for B-allele Frequency (BAF) generation

We performed germline haplotype calls using the [GATK Joint Genotyping Workflow](https://software.broadinstitute.org/gatk/best-practices/workflow?id=11145) on individual GVCFs from the normal sample alignment workflow.
Using only SNPs, we applied the [GATK generic hard filter suggestions](https://gatkforums.broadinstitute.org/gatk/discussion/2806/howto-apply-hard-filters-to-a-call-set) to the VCF, with an additional requirement of 10 reads minimum depth per SNP.
We used the filtered VCF as input to Control-FREEC and CNVkit (below) to generate B-allele frequency (BAF) files.
GATK v4.0.12.0 was used for all steps except `VariantFiltration`, which used 3.8.0 because as of GATK 4.0.12.0, this tool was beta and known to be unreliable for this purpose.
This single-sample workflow can be found in the [D3b GitHub repository](https://github.com/d3b-center/OpenPBTA-workflows).
References can be obtained from the [Broad Genome References on AWS](https://s3.console.aws.amazon.com/s3/buckets/broad-references/hg38/v0/) bucket, and a general description of references can be found athttps://s3.amazonaws.com/broad-references/broad-references-readme.html.

#### Somatic Mutation Calling

##### SNV and indel calling

For PBTA samples, we used four variant callers to call SNVs and indels from panel, WXS, and WGS data: Strelka2 [@doi:10.1038/s41592-018-0051-x], Mutect2 [@doi:10.1101/861054], Lancet [@doi:10.1038/s42003-018-0023-9], and VarDict [@doi:10.1093/nar/gkw227].
VarDict-only calls were not retained since ~ 39M calls with low VAF were uniquely called and may be potential false positives.
We used only Strelka2, Mutect2 and Lancet to analyze WXS samples from TCGA.
TCGA samples were captured using various WXS target capture kits and all the BED files were downloaded from [`GDC portal`](https://api.gdc.cancer.gov/files).
The input interval BED files for both panel and WXS data for PBTA samples were provided by the manufacturers.
All panel and WXS BED files were padded by 100 bp on each side during Strelka2, Mutect2, and VarDict runs and 400 bp for the Lancet run.  
For WGS calling, we utilized the non-padded BROAD Institute interval calling list [`wgs_calling_regions.hg38.interval_list`](https://console.cloud.google.com/storage/browser/_details/genomics-public-data/resources/broad/hg38/v0/wgs_calling_regions.hg38.interval_list), comprised of the full genome minus N bases, unless otherwise noted below.
Strelka2 [@doi:10/gdwrp4] v2.9.3 was run using default parameters for canonical chromosomes (chr1-22, X,Y,M), as recommended by the authors, and the final Strelka2 VCF was filtered for PASS variants.
Mutect2 from GATK v4.1.1.0 was run following Broad best practices outlined from their Workflow Description Language (WDL) [@url:https://github.com/broadinstitute/gatk/blob/4.1.1.0/scripts/mutect2_wdl/mutect2.wdl] and the final Mutect2 VCF was filtered for PASS variants.
To manage memory issues, VarDictJava [@doi:10.1093/nar/gkw227] v1.58 [@url:https://github.com/AstraZeneca-NGS/VarDictJava] was run using 20 Kb interval chunks of the input BED, padded by 100 bp on each side, such that if an indel occurred in between intervals, it would be captured.
Parameters and filtering followed [BCBIO standards](https://github.com/bcbio/bcbio-nextgen) except that variants with a variant allele frequency (VAF) >= 0.05 (instead of >= 0.10) were retained.
The 0.05 VAF increased the true positive rate for indels and decreased the false positive rate for SNVs when using VarDict in consensus calling.
The final VarDict VCF was filtered for PASS variants with TYPE=StronglySomatic.
Lancet v1.0.7 was run using default parameters, except for those noted below.
For input intervals to Lancet WGS, a reference BED was created by using only the UTR, exome, and start/stop codon features of the GENCODE 31 reference, augmented as recommended with PASS variant calls from Strelka2 and Mutect2 [@doi:10.1101/623702].
These intervals were then padded by 300 bp on each side during Lancet variant calling.
Per recommendations by the New York Genome Center [@doi:10.1101/623702] for WGS samples, the Lancet input intervals described above were augmented with PASS variant calls from Strelka2 and Mutect2 as validation.

##### VCF annotation and MAF creation

Normalization of INDELs using `bcftools norm` [@url:http://samtools.github.io/bcftools/bcftools.html#norm] was performed on all PASS VCFs using the following subworkflow [@url:https://github.com/d3b-center/OpenPBTA-workflows/blob/master/cwl/kfdrc_annot_vcf_sub_wf.cwl], release v3.
The ENSEMBL Variant Effect Predictor [@doi:10/gdz75c], reference release 93, was used to annotate variants and bcftools was used to add population allele frequency (AF) from gnomAD.
SNV and INDEL hotspots from v2 of MSKCC's database [@url:https://www.cancerhotspots.org/#/download] plus the C228T and C250T TERT promoter mutations [@doi:10.3390/ijms21176034] were annotated.
SNVs were annotated by matching amino acid position (`Protein_position` column in MAF file) with SNVs in the MSKCC database, splice sites were matched to `HGVSp_Short`values in the MSKCC database, and INDELs were matched based on amino acid present within the range of INDEL hotspots values in the MSKCC database.
Non-hotspot annotated variants with a normal depth of <= 7 and/or gnomAD AF > 0.001 were removed as potential germline variants.
TERT promoter mutations were matched using hg38 coordinates from Zvereva, et. al [@doi:10.3390/ijms21176034]: C228T occurs at 5:1295113, is annotated as existing variant `s1242535815`, `COSM1716563`, `COSM1716558`, and is 66 bp away from TSS and C250T occurs at Chr5:1295135, is annotated as existing variant `COSM1716559`, and is 88 bp away from TSS.

Variants annotated as PASS or HotSpotAllele=1 were retained in the final set. 
MAFs were created using MSKCC's vcf2maf [@url:https://github.com/mskcc/vcf2maf] v1.6.17.

##### Gather SNV and INDEL Hotspots
All variant calls from Strelka2, Mutect2, or Lancet that overlapped with an SNV or INDEL hotspot from v2 of MSKCC's database [@url:https://www.cancerhotspots.org/#/download] or the C228T and C250T TERT promoter mutations [@doi:10.3390/ijms21176034] were retained in a hotspot-specific MAF file, which was used for select analyses as described in the methods below.

##### Consensus SNV Calling

Our SNV calling process led to separate sets of predicted mutations for each caller.
We considered mutations to describe the same change if they were identical for the following MAF fields: `Chromosome`, `Start_Position`, `Reference_Allele`,  `Allele`, and `Tumor_Sample_Barcode`.
Strelka2 does not call multinucleotide variants (MNV), but instead calls each component SNV as a separate mutation, so we separated MNV calls from Mutect2 and Lancet into consecutive SNVs before comparing them with Strelka2.
We examined VAFs produced by each caller and compared their overlap with each other (**Figure S2**).
VarDict calls included many variants that were not identified by other callers (**Figure S2, panel C**), while the other callers produced results that were relatively consistent with one another.
Many of these VarDict-specific calls were variants with low allele frequency (**Figure S2, panel B**).
We termed mutations shared among the other three callers (Strelka2, Mutect2, and Lancet) to be consensus mutation calls and dropped VarDict due to concerns about it calling a large number of false positives.
Since our filtered set was based on the intersection of Strelka2, Mutect2, and Lancet, and because VarDict called nearly every mutation from the other three callers plus many unique mutations, the decision to not consider VarDict calls had little impact on the results.

#### Somatic Copy Number Variant Calling (WGS samples only)

We used Control-FREEC [@doi:10/ckt4vz; @doi:10/c6bcps] v11.6 and CNVkit [@doi:10.1371/journal.pcbi.1004873] v0.9.3 for copy number variant calls.
For both algorithms, the `germline_sex_estimate` (described below) was used as input for sample sex and germline variant calls (above) were used as input for BAF estimation.
Control-FREEC was run on human genome reference hg38 using the optional parameters of a 0.05 coefficient of variation, ploidy choice of 2-4, and BAF adjustment for tumor-normal pairs.
Theta2 [@doi:10.1093/bioinformatics/btu651] used VarDict germline and somatic calls, filtered on PASS and strongly somatic, to infer tumor purity.
Theta2 purity was added as an optional parameter to CNVkit to adjust copy number calls.
CNVkit was run on human genome reference hg38 using the optional parameters of Theta2 purity and BAF adjustment for tumor-normal pairs.
We used GISTIC [@doi:10.1186/gb-2011-12-4-r41] v.2.0.23 on the CNVkit and the consensus CNV segmentation files to generate gene-level copy number abundance (Log R Ratio) as well as chromosomal arm copy number alterations using the parameters specified in the [OpenPBTA Analysis repository](https://github.com/AlexsLemonade/OpenPBTA-analysis/blob/master/analyses/run-gistic/scripts/run-gistic-openpbta.sh).

##### Consensus CNV Calling

For each caller and sample, CNVs were called based on consensus among Control-FREEC [@doi:10/ckt4vz; @doi:10/c6bcps], CNVkit [@doi:10.1371/journal.pcbi.1004873], and Manta [@doi:10/gf3ggb].
CNVs called significant by Control-FREEC (p-value < 0.01) and Manta calls that passed all filters [@url:https://github.com/Illumina/manta/blob/75b5c38d4fcd2f6961197b28a41eb61856f2d976/docs/userGuide/README.md#vcf-format-fields] were included in consensus calling.
Sample and caller combination files with more than 2500 CNVs called were removed from the set; we expect these to be noisy and poor quality samples based on cutoffs used in GISTIC [@doi:10.1186/gb-2011-12-4-r41]. 
For each sample, the following regions are included in the final consensus set: 1) regions with reciprocal overlap of 50% or more between two of the three callers; 2) smaller CNV regions in which more than 90% of regions are covered by another caller. 
Any copy number alteration that was not called by two or more callers was not included in the consensus file. 
For the samples included in the consensus file, if a certain region had a neutral call, copy number of `NA` was defined for that region.
CNV regions within 10,000 bp of each other with the same direction of gain or loss were merged into single region.
We filtered out any CNVs that overlapped 50% or more with immunoglobulin, telomeric, centromeric, segment duplicated regions or were shorter than 3000 bp. 

#### Somatic Structural Variant Calling (WGS samples only)

We used Manta [@doi:10/gf3ggb] v1.4.0 for structural variant (SV) calls and was limited to regions used in Strelka2.
The hg38 reference for SV calling used was limited to canonical chromosome regions.
The somatic DNA workflows for SNV, indel, copy number, and SV calling can be found in the [OpenPBTA workflows Github repository](https://github.com/d3b-center/OpenPBTA-workflows/).
Manta output was annotated using [AnnotSV v2.1](https://lbgi.fr/AnnotSV/) [@doi:10.1093/bioinformatics/bty304] and the workflow can be found in the [D3b GitHub repository](https://github.com/d3b-center/annotSV/tree/master).

#### Gene Expression

##### Abundance Estimation

We used STAR [@doi:10/f4h523] v2.6.1d to align paired-end RNA-seq reads.
This output was used for all subsequent RNA analysis.
We used Ensembl GENCODE 27 [@url:https://www.gencodegenes.org/human/release_27.html] "Comprehensive gene annotation" as a reference.
We used RSEM [@doi:10/cwg8n5] v1.3.1 for both FPKM and TPM transcript- and gene-level quantification.
In addition, we used kallisto [@doi:10.1038/nbt.3519] v0.43.1 as a second method of quantification.
This method differs in that it uses pseudoaligments using FASTQ reads directly to the aforementioned GENCODE 27 reference.

##### Gene Expression Matrices with Unique HUGO Symbols

Algorithms that perform gene set enrichment, molecular subtyping, or immune-profiling, for example, require an RNA-seq gene expression matrix as input, with HUGO gene symbols as row names and sample names as column names.
There is a small proportion of gene symbols that map to multiple Ensembl gene identifiers (in GENCODE v27, 212 gene symbols map to 1866 Ensembl gene identifiers), termed multi-mapped gene symbols.

We first removed genes with no expression from the RSEM abundance data by requiring an FPKM > 0 in at least 1 sample across the PBTA cohort.
We computed the mean FPKM across all samples per gene and for each multi-mapped gene symbol, we chose the Ensembl identifier corresponding to the maximum mean FPKM with the goal of choosing the identifier that best represented the expression of the gene.
After collapsing gene identifiers, there were a total of 46,400 uniquely expressed genes in the poly-A dataset and a total of 53,011 uniquely expressed genes remaining in the stranded dataset.
Additional details can be found in the [`collapse-rnaseq` analysis module](https://github.com/AlexsLemonade/OpenPBTA-analysis/tree/master/analyses/collapse-rnaseq).

##### Gene fusion detection

We set up Arriba v1.1.0 [@doi:10.1101/gr.257246.119] and STAR-Fusion 1.5.0 [@doi:10.1101/120295] fusion detection tools using CWL on CAVATICA.
For both of these tools, we used aligned BAM and chimeric SAM files from STAR as inputs and `GRCh38_gencode_v27` GTF for gene annotation.
We ran STAR-Fusion with default parameters and annotated all fusion calls with `GRCh38_v27_CTAT_lib_Feb092018.plug-n-play.tar.gz` provided in the STAR-fusion release.
For Arriba, we used a blacklist file `blacklist_hg38_GRCh38_2018-11-04.tsv.gz` from the Arriba release to remove recurrent fusion artifacts and transcripts present in healthy tissue.
We provided Arriba with strandedness information for stranded samples, or we set it to auto-detection for poly-A samples.
We used [FusionAnnotator](https://github.com/FusionAnnotator/FusionAnnotator) on Arriba fusion calls to harmonize annotations with those of STAR-Fusion.
The RNA expression and fusion workflows can be found in the [D3b GitHub repository](https://github.com/d3b-center/OpenPBTA-workflows/blob/master/cwl/kfdrc_RNAseq_workflow.cwl).
The FusionAnnotator workflow can also be found in the [D3b GitHub repository](https://github.com/d3b-center/FusionAnnotator).

### QUANTIFICATION AND STATISTICAL ANALYSIS

##### Recurrently mutated genes and co-occurrence of gene mutations

Using the consensus SNV calls, we identified genes that were recurrently mutated in the OpenPBTA cohort, including nonsynonymous mutations with a VAF > 5% among the set of independent samples.
The set of nonsynonymous mutations was determined using ENSEMBL Variant Effect Predictor [@doi:10/gdz75c] annotations, including "High" and "Moderate" consequence types as defined in `maftools v. 2.2.10` [@doi:10.1101/gr.239244.118].
For each gene, we then tallied the number of samples that had at least one nonsynonymous mutation.

For genes that contained nonsynonymous mutations in multiple samples, we calculated pairwise mutation co-occurrence scores.
This score was defined as the $I\times -\log_{10}(P)$ where $I$ is 1 when the odds ratio is > 1 (indicating co-occurrence), and -1 when the odds ratio is < 1 (indicating mutual exclusivity), with $P$ defined by  Fisher's Exact Test.

##### Focal Copy Number Calling

We added the ploidy inferred via Control-FREEC to the consensus CNV segmentation file and used the ploidy and copy number values to define gain and loss values broadly at the chromosome level.
We used `bedtools coverage` [@url:https://bedtools.readthedocs.io/en/latest/content/tools/coverage.html; @doi:10.1093/bioinformatics/btq033] to add cytoband status using the (UCSC cytoband file)[url:http://hgdownload.cse.ucsc.edu/goldenpath/hg38/database/cytoBand.txt.gz] [@doi:10.1093/nar/gks1048].
The output status call fractions, which are values of the loss, gain, and callable fractions of each cytoband region, were used to define dominant status at the cytoband-level.
The weighted means of each status call fraction were calculated using band length.
We used the weighted means to define the dominant status at the chromosome arm-level.

A status was considered dominant if more than half of the region was callable and the status call fraction was greater than 0.9 for that region.
The 0.9 threshold was chosen to ensure that the dominant status fraction call is greater than the remaining status fraction calls in a region.

We aimed to define focal copy number units to avoid calling adjacent genes in the same cytoband or arm as copy number losses or gains where it would be more appropriate to call the broader region a loss or gain.
To determine the most focal units, we first considered the dominant status calls at the chromosome arm-level.
If the chromosome arm dominant status was callable but not clearly defined as a gain or loss, we instead included the cytoband-level status call.
Similarly, if a cytoband dominant status call was callable but not clearly defined as a gain or loss, we instead included gene-level status call.
To obtain the gene-level data, we used the `mergeByOverlaps` [function](@url:https://www.rdocumentation.org/packages/IRanges/versions/2.6.1/topics/findOverlaps-methods) from the IRanges package in R [@doi:10.1371/journal.pcbi.1003118] to find overlaps between the segments in the consensus CNV file and the exons in the [GENCODE v27 annotation file](https://www.gencodegenes.org/human/release_27.html).
If the copy number value was 0, we set the status to "deep deletion". 
For autosomes only, we set the status to "amplification" when the copy number value was greater than two times the ploidy value.

#### Chromothripsis Analysis (WGS samples only)

Candidate chromothripsis regions were identified in the set of independent tumor WGS samples with ShatterSeek [@doi:10.1038/s41588-019-0576-7], using Manta SV calls that passed all filters and consensus CNV calls. 
Only chromosomes 1-22 and X were considered. 
The consensus CNV data were modified to fit ShatterSeek input requirements: CNV-neutral or excluded regions (both annotated as `NA` in the consensus data) were filled in with the respective sample’s ploidy value from Control-FREEC, and consecutive segments with the same copy number value were merged. 
Candidate chromothripsis regions were classified as high- or low-confidence by applying the statistical criteria described by the ShatterSeek authors.

##### Immune Profiling and Deconvolution

We used the R package `immunedeconv` [@pmid:31510660; @url:https://github.com/icbi-lab/immunedeconv] with the method `quanTIseq` [@10.1186/s13073-019-0638-6] to deconvolute various immune cell types across tumors from the PBTA cohort in the stranded and poly-A collapsed FPKM RNA-seq datasets ([`immune-deconv` analysis module](https://github.com/AlexsLemonade/OpenPBTA-analysis/tree/master/analyses/immune-deconv)). 
The `quanTIseq` deconvolution method directly estimates absolute fractions of 10 immune cell types that represent inferred proportions of the cell types in the mixture. 
Therefore, we utilized `quanTIseq` for inter-sample, intra-sample, and inter-histology score comparisons.

##### Gene Set Variation Analysis

We performed Gene Set Variation Analysis (GSVA) [@doi:10.1186/1471-2105-14-7] on collapsed, log2-transformed RSEM FPKM data using the GSVA Bioconductor package [@doi:10.18129/B9.bioc.GSVA] with setting `mx.diff=TRUE` to obtain Gaussian-distributed scores ([`gene-set-enrichment-analysis` analysis module](https://github.com/AlexsLemonade/OpenPBTA-analysis/tree/master/analyses/gene-set-enrichment-analysis)) for each of the MSigDB hallmark gene sets [@doi:10.1016/j.cels.2015.12.004].
We compared GSVA scores among histology groups (`cancer_group`) using ANOVA and subsequent Tukey tests; p-values were Bonferroni-corrected for multiple hypothesis testing.	

##### Transcriptomic Dimension reduction

We applied Uniform Manifold Approximation and Projection (UMAP) [@arxiv:1802.03426v2] to log2-transformed FPKM data using the umap R package [@url:https://cran.r-project.org/package=umap].
We set the number of neighbors to 15 ([`transcriptomic-dimension-reduction` analysis module](https://github.com/AlexsLemonade/OpenPBTA-analysis/tree/master/analyses/transcriptomic-dimension-reduction)).

##### Fusion prioritization

We performed artifact filtering and additional annotation on fusion calls to prioritize putative oncogenic fusions.
Briefly, we considered all in frame and frameshift fusion calls with a minimum of 1 junction reads and at least one gene partner expressed (TPM > 1) to be true calls.
If a fusion call had large number of spanning fragment reads compared to junction reads (spanning fragment minus junction read greater than ten), we removed these calls as potential false positives.
We prioritized a union of fusion calls as true calls if the fused genes were detected by both callers, the same fusion was recurrent within a `broad_histology` (>2 samples) or the fusion was specific to the `broad_histology`.
If either 5' or 3' genes fused to more than five different genes within a sample, we removed these calls as potential false positives.
We annotated putative driver fusions and prioritized fusions based on partners containing known [kinases](http://kinase.com/human/kinome/tables/Kincat_Hsap.08.02.xls), [oncogenes](http://www.bushmanlab.org/assets/doc/allOnco_Feb2017.tsv), [tumor suppressors](https://bioinfo.uth.edu/TSGene/Human_TSGs.txt?csrt=5027697123997809089), curated transcription factors [@doi:10.1016/j.cell.2018.01.029], [COSMIC genes](https://cancer.sanger.ac.uk/census), and/or known [TCGA fusions](https://tumorfusions.org/PanCanFusV2/downloads/pancanfus.txt.gz) from curated [references](https://github.com/AlexsLemonade/OpenPBTA-analysis/tree/master/analyses/fusion_filtering/references).
_MYBL1_ [@doi:10.1073/pnas.1300252110], _SNCAIP_ [@doi:10.1038/nature11327], _FOXR2_ [@doi:10.1016/j.cell.2016.01.015], _TTYH1_ [@doi:10.1038/ng.2849], and _TERT_ [@doi:10.1038/ng.3438; @doi:10.1002/gcc.22110; @doi:10.1016/j.canlet.2014.11.057; @doi:10.1007/s11910-017-0722-5] were added to the oncogene list and _BCOR_ [@doi:10.1016/j.cell.2016.01.015] and _QKI_ [@doi:10.1038/ng.3500] were added to the tumor suppressor gene list based on pediatric cancer literature review.
The fusion filtering workflow can be found in the [OpenPBTA Analysis repository](https://github.com/AlexsLemonade/OpenPBTA-analysis/tree/master/analyses/fusion_filtering).

#### Oncoprint figure generation

Maftools [@doi:10.1101/gr.239244.118] was used to generate oncoprints depicting the frequencies of canonical somatic gene mutations, CNVs, and fusions for the top 20 genes mutated across primary tumors within broad histologies of the OpenPBTA dataset.
Canonical genes were collated from review of the literature for low-grade astrocytic tumors [@doi:10.1186/s40478-020-00902-z], embryonal tumors [@doi:10.1038/nature22973; @doi:10.1007/s00401-020-02182-2; @doi:10.1186/s40478-020-00984-9; @doi:10.1016/j.ccell.2016.02.001; @doi:10.1038/s41598-020-59812-8], diffuse astrocytic and oligodendroglial tumors [@doi:10.1016/j.ccell.2017.08.017; @doi:10.1002/ijc.32258; @doi:10.1093/neuonc/noab106; @doi:10.1186/s40478-020-00905-w],  and other tumors (ependymal tumors, craniopharyngiomas, neuronal-glial mixed tumors, histiocytic tumors, chordoma, meningioma, and choroid plexus tumors) [@doi:10.1186/s40478-020-01056-8; @doi:10.1007/s00381-017-3481-3; @doi:10.1016/j.ccell.2015.04.002; 
@doi:10.1038/nature13109; @doi:10.1038/s41525-017-0014-7; @doi:10.3171/2019.8.JNS191266; @doi:10.1007/s00401-016-1539-z; @doi:10.1093/neuonc/noaa267; @doi:10.1016/s0002-9440(10)64477-x; @doi:10.1016/j.jaad.2017.05.059].

#### Mutational Signatures

We obtained weights (i.e., exposures) for signature sets using the `deconstructSigs` R package function `whichSignatures()` [@doi:10.1186/s13059-016-0893-4; @url:https://github.com/raerose01/deconstructSigs] from consensus SNVs with the BSgenome.Hsapiens.UCSC.hg38 annotations [@url:https://bioconductor.org/packages/release/data/annotation/html/BSgenome.Hsapiens.UCSC.hg38.html].
Specifically, we estimated signature weights across samples for eight signatures previously identified in the Signal reference set of signatures ("RefSig") as associated with adult central nervous system (CNS) tumors [@doi:10.1038/s43018-020-0027-5].
These eight RefSig signatures are 1, 3, 8, 11, 18, 19, N6, and MMR2.
Weights for signatures fall in the range zero to one inclusive.
`deconstructSigs` estimates the weights for each signature across samples and allows for a proportion of unassigned weights referred to as "Other" in the text.
These results do not include signatures with small contributions; `deconstructSigs` drops signature weights that are less than 6% [@doi:10.1186/s13059-016-0893-4].

### Tumor Mutation Burden

We consider tumor mutation burden (TMB) to be the number of consensus SNVs per *effectively surveyed* base of the genome.
We considered base pairs to be *effectively surveyed* if they were in the intersection of the genomic ranges considered by the callers used to generate the consensus and where appropriate, regions of interest, such as coding sequences.

$$ \textrm{TMB} = \frac{\textrm{\# of coding sequence SNVs}}{\textrm{Size in Mb of {\em effectively surveyed} genome}}
$$

We used the total number coding sequence consensus SNVs for the numerator and the size of the intersection of the regions considered by Strelka2 and Mutect2 with coding regions (CDS from GENCODE v27 annotation [@url:https://www.gencodegenes.org/human/release_27.html]) as the denominator.

Lancet showed a bias for calling mutations with a much lower VAF for WXS than WGS data (**Figure S2, panel G**).
Since TCGA data was all WXS, we dropped Lancet from TMB calculations.

#### Clinical Data Harmonization
<!-- TODO: pull these "S1 and S2 tables out and append to actual Table S1" -->

##### WHO Classification of Disease Types

**Table S1** contains sample technical, clinical, and additional metadata used for this study. 
The `pathology_diagnosis` field in the `pbta-histologies.tsv` file contains one or more diagnoses from on the patient's pathology report.
The `pathology_free_text_diagnosis` field in the `pbta-histologies.tsv` file contains additional free text diagnosis information gathered from the patient's pathology report.
The `broad_histology` denotes the broad 2016 WHO classification for each tumor.
The `short_histology` is an abbreviated version of either the `broad_histology` or `integrated_diagnosis` for plotting purposes.
Except for LGG samples, the `integrated_diagnosis` field in the `pbta-histologies.tsv` file was derived to match a standardized 2016 WHO diagnosis [@doi:10.1007/s00401-016-1545-1] based on `pathology_diagnosis`, molecular subtyping, and in some cases, additional pathology review.
The `harmonized_diagnosis` is the final `integrated_diagnosis`, if one exists, or a diagnosis derived from the `pathology_diagnosis` and `pathology_free_text_diagnosis` in the absence of molecular data.
The `cancer_group` is a grouping narrower than `broad_histology` derived within the [molecular subtyping integrate module](https://github.com/AlexsLemonade/OpenPBTA-analysis/tree/master/analyses/molecular-subtyping-integrate) for plotting and analysis purposes.
With clinician assistance, the `CNS_region` was categorized as hemispheric, midline, mixed, optic pathway, posterior fossa, spine, suprasellar, ventricles or other based on specimen location (see table below).


| Clinical and Histology Metadata | Definition                                                                                                                                  | Possible values                                                                                                                               |
|---------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------|
| age_at_diagnosis_days           | Patient age at diagnosis in days                                                                                                            | numeric                                                                                                                                       |
| age_last_update_days            | Patient age at the last clinical event/update in days                                                                                       | numeric                                                                                                                                       |
| aliquot_id                      | External aliquot identifier                                                                                                                 | variable                                                                                                                                      |
| broad_histology                 | Broad WHO 2016 classification of cancer type                                                                                                | text                                                                                                                                          |
| cancer_group                    | Harmonized cancer groupings for plots                                                                                                       | text                                                                                                                                          |
| cancer_predispositions          | Reported cancer predisposition syndromes                                                                                                    | text                                                                                                                                          |
| CNS_region                      | Harmonized brain region based on `primary_site`                                                                                             | Hemispheric;Midline;Mixed;Optic pathway;Other;Posterior fossa;Spine;Suprasellar;Ventricles                                                    |
| cohort                          | Scientific cohort                                                                                                                           | CBTN;PNOC                                                                                                                                     |
| cohort_participant_id           | Scientific cohort participant ID                                                                                                            | C#####-C######                                                                                                                                |
| composition                     | Sample composition                                                                                                                          | Derived Cell Line;Not Reported;Peripheral Whole Blood;Saliva;Solid Tissue                                                                     |
| ethnicity                       | Patient reported ethnicity                                                                                                                  | text                                                                                                                                          |
| experimental_strategy           | Sequencing strategy                                                                                                                         | WGS;WXS;RNA-Seq;Panel                                                                                                                         |
| extent_of_tumor_resection       | Amount of tumor resected at time of surgical event                                                                                          | Biopsy only;Partial resection;Gross/Near total resection;Not Reported;Unavailable                                                             |
| germline_sex_estimate           | Predicted sex of patient based on germline X and Y ratio calculation (described in methods)                                                 | Female;Male;Unknown                                                                                                                           |
| harmonized_diagnosis            | `integrated_diagnosis`, if exists, or updated and harmonized diagnosis using pathology_free_text_diagnosis information                      | text                                                                                                                                          |
| integrated_diagnosis            | 2016 WHO diagnosis integrated from pathology diagnosis and molecular subtyping                                                              | text                                                                                                                                          |
| Kids_First_Biospecimen_ID       | KidsFirst biospecimen identifier                                                                                                            | BS_########                                                                                                                                   |
| Kids_First_Participant_ID       | KidsFirst patient identifier                                                                                                                | PT_########                                                                                                                                   |
| molecular_subtype               | Molecular subtype defined by WHO 2016 guidelines                                                                                            | text                                                                                                                                          |
| normal_fraction                 | Theta2 normal DNA fraction estimate                                                                                                         | numeric                                                                                                                                       |
| Notes                           | Free text field describing changes from `pathology_diagnosis` to `integrated_diagnosis` or manner in which molecular_subtype was determined | text                                                                                                                                          |
| OS_days                         | Overall survival in days                                                                                                                    | numeric                                                                                                                                       |
| OS_status                       | Overall survival status                                                                                                                     | DECEASED;LIVING                                                                                                                               |
| parent_aliquot_id               | External identifier combining sample_id, sample_type, aliquot_id, and sequencing_strategy for some samples                                  | text                                                                                                                                          |
| pathology_diagnosis             | Reported and/or harmonized patient diagnosis from pathology reports                                                                         | text                                                                                                                                          |
| pathology_free_text_diagnosis   | Free text patient diagnosis from pathology reports                                                                                          | text                                                                                                                                          |
| PFS_days                        | Progression-free survival in days                                                                                                           | numeric                                                                                                                                       |
| primary_site                    | Bodily site(s) from which specimen was derived                                                                                              | text                                                                                                                                          |
| race                            | Patient reported race                                                                                                                       | text                                                                                                                                          |
| reported_gender                 | Patient reported gender                                                                                                                     | text                                                                                                                                          |
| RNA_library                     | Type of RNA-Sequencing library preparation                                                                                                  | stranded;poly-A                                                                                                                               |
| sample_id                       | External biospecimen identifier                                                                                                             | variable                                                                                                                                      |
| sample_type                     | Broad sample type                                                                                                                           | Normal;Tumor                                                                                                                                  |
| seq_center                      | Sequencing center                                                                                                                           | BGI;BGI@CHOP Genome Center;Genomic Clinical Core at Sidra Medical and Research Center;NantOmics;The Translational Genomics Research Institute |
| short_histology                 | Abbreviated `integrated_diagnosis` or `broad_histology` for plotting purposes                                                               | text                                                                                                                                          |
| tumor_descriptor                | Phase of therapy from which tumor was derived                                                                                               | Initial CNS Tumor;Progressive Progressive Disease Post-Mortem;Recurrence;Second Malignancy;Unavailable                                        |
| tumor_fraction                  | Theta2 tumor DNA fraction estimate                                                                                                          | numeric                                                                                                                                       |
| tumor_ploidy                    | Control-FREEC ploidy                                                                                                                        | numeric                                                                                                                                       |


Table S1. Clinical metadata collected for OpenPBTA. {#tbl:S1}


| CNS_region      | primary_site                                                                                                                   |
|-----------------|--------------------------------------------------------------------------------------------------------------------------------|
| Hemispheric     | Frontal Lobe,Temporal Lobe,Parietal Lobe,Occipital Lobe                                                                        |
| Midline         | Pons/Brainstem,Brain Stem- Midbrain/Tectum,Brain Stem- Pons,Brain Stem-Medulla,Thalamus,Basal Ganglia,Hippocampus,Pineal Gland |
| Spine           | Spinal Cord- Cervical,Spinal Cord- Thoracic,Spinal Cord- Lumbar/Thecal Sac,Spine NOS                                           |
| Ventricles      | Ventricles                                                                                                                     |
| Posterior fossa | Cerebellum/Posterior Fossa                                                                                                     |
| Optic pathway   | Optic Pathway                                                                                                                  |
| Suprasellar     | Suprasellar/Hypothalamic/Pituitary                                                                                             |
| Other           | Meninges/Dura,Other locations NOS,Skull,Cranial Nerves NOS,Brain                                                               |


Table S2. Harmonized CNS brain regions derived from primary site values. {#tbl:S2}


##### Molecular Subtyping

The `molecular_subtype` column in the `pbta-histologies.tsv` file contains molecular subtypes for tumor types selected from  `pathology_diagnosis` and `pathology_free_text_diagnosis` fields as described below, following World Health Organization 2016 classification criteria [@doi:10.1007/s00401-016-1545-1].

Medulloblastoma (MB) subtypes SHH, MYC, Group 3, and Group 4 were predicted using the consensus of two RNA expression classifiers: Medulloblastoma Classifier [@doi:10.1371/journal.pcbi.1008263] and MM2S Classifier [@doi:10.1186/s13029-016-0053-y] on the RSEM FPKM data.

High-grade glioma (HGG) subtypes were derived using the criteria below (additional details in the [analysis README](https://github.com/AlexsLemonade/OpenPBTA-analysis/tree/master/analyses/molecular-subtyping-HGG)):

1. If any sample contained an _H3F3A_ p.K28M, _HIST1H3B_ p.K28M, _HIST1H3C_ p.K28M, or _HIST2H3C_ p.K28M mutation and no _BRAF_ p.V600E mutation, it was subtyped as `DMG, H3K28`.
2. If any sample contained an _HIST1H3B_ p.K28M, _HIST1H3C_ p.K28M, or _HIST2H3C_ p.K28M mutation and a _BRAF_ p.V600E mutation, it was subtyped as `DMG, H3 K28, BRAF V600E`.
3. If any sample contained an _H3F3A_ p.G35V or p.G35R mutation, it was subtyped as`HGG, H3 G35`.
4. If any high-grade glioma sample contained an _IDH1_ p.R132 mutation, it was subtyped as `HGG, IDH`.
5. If a sample was initially classified as HGG, had no defining histone mutations, and a BRAF p.V600E mutation, it was subtyped as `BRAF V600E`.
6. All other high-grade glioma samples that did not meet any of these criteria were subtyped as `HGG, H3 wildtype`.

Embryonal tumors were included in non-MB and non-ATRT embryonal tumor subtyping if they met any of the following criteria:
1. A _TTYH1_ (5' partner) fusion was detected.
2. A _MN1_ (5' partner) fusion was detected, with the exception of `MN1--PATZ1` since it is an entity separate of CNS HGNET-MN1 tumors [@doi:10.1111/nan.12626].
3. Pathology diagnoses included "Supratentorial or Spinal Cord PNET" or "Embryonal Tumor with Multilayered Rosettes".
4. A pathology diagnosis of "Neuroblastoma", where the tumor was not indicated to be peripheral or metastatic and was located in the CNS.
5. Any sample with "embryonal tumor with multilayer rosettes, ros (who grade iv)", "embryonal tumor, nos, congenital type", "ependymoblastoma" or "medulloepithelioma" in pathology free text.

Non-MB and non-ATRT embryonal tumors identified with the above criteria were further subtyped using the criteria below [@pmid:30249036; @doi:10.1007/s00381-017-3551-6; @url:https://www.cancer.gov/types/brain/hp/child-cns-embryonal-treatment-pdq; @doi:10.3390/ijms21051818].
Additional details can be found in the analysis [notebook](https://alexslemonade.github.io/OpenPBTA-analysis/analyses/molecular-subtyping-embryonal/04-table-prep.nb.html).

1. Any RNA-seq biospecimen with _LIN28A_ overexpression, plus a _TYH1_ fusion (5' partner) with a gene adjacent or within the C19MC miRNA cluster and/or copy number amplification of the C19MC region was subtyped as `ETMR, C19MC-altered` (Embryonal tumor with multilayer rosettes, chromosome 19 miRNA cluster altered) [@doi:10.1007/s00401-012-1068-3; 10.1038/ng.2849].
2. Any RNA-seq biospecimen with _LIN28A_ overexpression, a _TTYH1_ fusion (5' partner) with a gene adjacent or within the C19MC miRNA cluster but no evidence of copy number amplification of the C19MC region was subtyped as `ETMR, NOS` (Embryonal tumor with multilayer rosettes, not otherwise specified) [@doi:10.1007/s00401-012-1068-3; @doi:10.1038/ng.2849].
3. Any RNA-seq biospecimen with a fusion having a 5' _MN1_ and 3' _BEND2_ or _CXXC5_ partner were subtyped as `CNS HGNET-MN1` (Central nervous system (CNS) high-grade neuroepithelial tumor with _MN1_ alteration).
4. Non-MB and non-ATRT embryonal tumors with internal tandem duplication (as defined in [@doi:10.1186/s12859-016-1031-8]) of _BCOR_ were subtyped as `CNS HGNET-BCOR` (CNS high-grade neuroepithelial tumor with _BCOR_ alteration).
5. Non-MB and non-ATRT embryonal tumors with over-expression and/or gene fusions in _FOXR2_ were subtyped as `CNS NB-FOXR2` (CNS neuroblastoma with _FOXR2_ activation).
6. Non-MB and non-ATRT embryonal tumors with _CIC-NUTM1_ or other _CIC_ fusions, were subtyped as `CNS EFT-CIC` (CNS Ewing sarcoma family tumor with _CIC_ alteration) [@doi:/j.cell.2016.01.015]
7. Non-MB and non-ATRT embryonal tumors that did not fit any of the above categories were subtyped as `CNS Embryonal, NOS` (CNS Embryonal tumor, not otherwise specified).

Neurocytoma subtypes central neurocytoma (CNC) and extraventricular neurocytoma (EVN) were assigned based on the primary site of the tumor [@doi:10.1007/978-3-319-33432-5_20].
If `primary_site` of the tumor was `Ventricles`, it was subtyped as `CNC`; otherwise, it was subtyped as `EVN`.

Craniopharyngiomas (CRANIO) were subtyped into adamantinomatous (`CRANIO, ADAM`), papillary (`CRANIO, PAP`) or undetermined (`CRANIO, To be classified`) based on the following criteria [@doi:10.3171/jns.1995.83.2.0206; @doi:10.3171/jns.1998.89.4.0547]:
1. Craniopharyngiomas from patients over 40 years old with a _BRAF_ p.V600E mutation were subtyped as `CRANIO, PAP`.
2. Craniopharyngiomas from patients younger than 40 years old with mutations in exon 3 of _CTNNB1_ were subtyped as `CRANIO, ADAM`.
3. Craniopharyngiomas that do not fall into the above two categories were subtyped as `CRANIO, To be classified`. 

A molecular subtype of `EWS` was assigned to any tumor with a _EWSR1_ fusion or with a `pathology_diagnosis` of `Ewings Sarcoma`. 

Low-grade gliomas (LGG) or glialneuronal tumors (GNT) were subtyped based on SNV, fusion and CNV status based on @doi:10.1016/j.ccell.2020.03.011, and as described below.
1. If a sample contained a _NF1_ somatic mutation, either nonsense or missense, it was subtyped as `LGG, NF1-somatic`.
2. If a sample contained _NF1_ germline mutation, as indicated by a patient having the neurofibromatosis  cancer predisposition, it was subtyped as `LGG, NF1-germline`.
3. If a sample contained the _IDH_ p.R132 mutation, it was subtyped as `LGG, IDH`.
4. If a sample contained a histone p.K28M mutation in either _H3F3A_, _H3F3B_, _HIST1H3B_, _HIST1H3C_, or _HIST2H3C_, or if it contained a p.G35R or p.G35V mutation in _H3F3A_, it was subtyped as `LGG, H3`.
5. If a sample contained _BRAF_ p.V600E or any other non-canonical _BRAF_ mutations in the kinase (PK_Tyr_Ser-Thr) domain [@url:https://pfam.xfam.org/family/PF07714], it was subtyped as `LGG, BRAF V600E`.
6. If a sample contained `KIAA1549--BRAF` fusion, it was subtyped as `LGG, KIAA1549-BRAF`.
7. If a sample contained SNV or indel in either _KRAS_, _NRAS_, _HRAS_, _MAP2K1_, _MAP2K2_, _MAP2K1_, _ARAF_, _RAF1_, or non-kinase domain of _BRAF_, or if it contained _RAF1_ fusion, or _BRAF_ fusion that was not `KIAA1549--BRAF`, it was subtyped as `LGG, other MAPK`.
8. If a sample contained SNV in either _MET_, _KIT_ or _PDGFRA_, or if it contained fusion in _ALK_, _ROS1_, _NTRK1_, _NTRK2_, _NTRK3_ or _PDGFRA_, it was subtyped as `LGG, RTK`.
9. If a sample contained _FGFR1_ p.N546K, p.K656E, p.N577, or p. K687 hotspot mutations, or tyrosine kinase domain tandem duplication [@url:http://hgdownload.soe.ucsc.edu/goldenPath/hg38/database/pfamDesc.txt.gz], or _FGFR1_ or _FGFR2_ fusions, it was subtyped as `LGG, FGFR`.
10. If a sample contained _MYB_ or _MYBL1_ fusion, it was subtyped as `LGG, MYB/MYBL1`.
11. If a sample contained focal CDKN2A and/or CDKN2B  deletion, it was subtyped as `LGG, CDKN2A/B`.

For LGG tumors that did not have any of the above molecular alterations, if both RNA and DNA samples were available, it was subtyped as `LGG, wildtype`. 
Otherwise, if either RNA or DNA sample was unavailable, it was subtyped as `LGG, To be classified`.

If pathology diagnosis was `Subependymal Giant Cell Astrocytoma (SEGA)`, the `LGG` portion of molecular subtype was recoded to `SEGA`.

Lastly, for all subtyped samples, if the tumors were glialneuronal in origin, based on `pathology_free_text_diagnosis` entries of `desmoplastic infantile`,`desmoplastic infantile ganglioglioma`, `desmoplastic infantile astrocytoma` or `glioneuronal`, each was recoded as follows:
If pathology diagnosis is `Low-grade glioma/astrocytoma (WHO grade I/II)` or `Ganglioglioma`, the `LGG` portion of the molecular subtype was recoded to `GNT`.

Ependymoma (EPN) were subtyped into `EPN, ST RELA`, `EPN, ST YAP1`, `EPN, PF A` and `EPN, PF B` based on evidence for these molecular subgroups as described in Pajtler et al. [@doi:10.1016/j.ccell.2015.04.002]. 
Briefly, fusion, CNV and gene expression data were used to subtype EPN as followed:
1. Any tumor with fusions containing `RELA` as fusion partner, e.g., `C11orf95--RELA`, `LTBP3--RELA`, was subtyped as `EPN, ST RELA`.
2. Any tumor with fusions containing `YAP1` as fusion partner, such as `C11orf95--YAP1`, `YAP1--MAMLD1` and `YAP1--FAM118B`, was subtyped as `EPN, ST YAP1`.
3. Any tumor with the following molecular characterization would be subtyped as `EPN, PF A`: 
- _CXorf67_ expression z-score of over 3
- _TKTL1_ expression z-score of over 3 and 1q gain
4. Any tumor with the following molecular characterization would be subtyped as `EPN, PF B`:
- _GPBP17_ expression z-score of over 3 and loss of 6q or 6p
- _IFT46_ expression z-score of over 3 and loss of 6q or 6p

Any tumor with the above molecular characteristics would be exclusively subtyped to the designated group. 

For all other remaining EPN tumors without above molecular characteristics, they would be subtyped to `EPN, ST RELA` and `EPN, ST YAP1` in a non-exclusive way (e.g., a tumor could have both `EPN, ST RELA` and `EPN, ST YAP1` subtypes) if any of the following alterations were present.
1. Any tumor with the following alterations was assigned `EPN, ST RELA`:
- `PTEN--TAS2R1` fusion 
- chromosome 9 arm (9p or 9q) loss 
- _RELA_ expression z-score of over 3 
- _L1CAM_ expression z-score of over 3 
2. Any tumor with the following alterations was assigned `EPN, ST YAP1`:
- `C11orf95--MAML2` fusion 
- chromosome 11 short arm (11p) loss  
- chromosome 11 long arm (11q) gain
- _ARL4D_ expression z-score of over 3 
- _CLDN1_ expression z-score of over 3

After all relevant tumor samples were subtyped by the above molecular subtyping modules, the results from these modules, along with other clinical information (such as pathology diagnosis free text), were compiled through `molecular-subtyping-pathology` module. 
The compilation was executed by the following steps:

Firstly, `broad_histology`, `short_histology`, and `integrated_diagnosis` columns in the result files from the above subtyping modules (i.e., `CRANIO_molecular_subtype.tsv`, `EWS_results.tsv`, `EPN_all_data_withsubgroup.tsv`, `HGG_molecular_subtype.tsv` ,`LGG_subtyping.tsv`, `MB_molecular_subtype.tsv`, `embryonal_tumor_molecular_subtypes.tsv`, and `neurocytoma_subtyping.tsv`) were updated based on the molecular subtype of the tumor. 
Detailed information about the updating procedure were included in the analysis [notebook](https://github.com/AlexsLemonade/OpenPBTA-analysis/blob/master/analyses/molecular-subtyping-pathology/01-compile-subtyping-results.Rmd).
Notes were also added to indicated that the changes in `broad_histology`, `short_histology` and `integrated_diagnosis` were from OpenPBTA subtyping modules.

Subsequently, `broad_histology`, `short_histology` and `harmonized_diagnosis` columns of tumors with particular pathology diagnosis free text were updated as specified in the following table:

pathology_diagnosis | subtyping module | pathology_free_text_diagnosis | broad_histology | short_histology | harmonized_diagnosis
-- | -- | -- | -- | -- | --
Primary CNS lymphoma | NA | contains `burkitt's lymphoma` | Lymphoma | CNS lymphoma | CNS Burkitt's lymphoma
Other | NA | contains `xanthogranuloma` or `jxg` | Histiocytic tumor | JXG | Juvenile xanthogranuloma
Meningioma | NA | contains `atypical` | Meningioma | Meningioma | Atypical meningioma
Meningioma | NA | contains `anaplastic` | Meningioma | Meningioma | Anaplastic (malignant) meningioma
Meningioma | NA | contains `clear cell meningioma` | Meningioma | Meningioma | Clear cell meningioma
Meningioma | NA | contains `meningothelial` | Meningioma | Meningioma | Meningothelial meningioma
Meningioma | NA | does not contain `atypical`, `anaplastic`, `clear cell`, or `meningothelial` | Meningioma | Meningioma | Meningioma
Choroid plexus papilloma | NA | contains `atypical` | Choroid plexus tumor | Choroid plexus tumor | Atypical choroid plexus papilloma
Craniopharyngioma | CRANIO | contains `adamantinomatous` | Tumors of sellar region | Craniopharyngioma | Adamantinomatous craniopharyngioma 

Similarly, `broad_histology`, `short_histology`, `integrated_diagnosis` and `harmonized_diagnosis` columns of tumors with following pathology diagnosis free text were updated as specified in the table below:

pathology_diagnosis | subtyping module | pathology_free_text_diagnosis | broad_histology | short_histology | integrated_diagnosis
-- | -- | -- | -- | -- | --
Low-grade glioma/astrocytoma (WHO grade I/II) | LGG | contains `sega or subependymal giant cell astrocytoma` | Low grade astrocytic tumor | LGG | Subependymal Giant Cell Astrocytoma, <subtype>
Low-grade glioma/astrocytoma (WHO grade I/II) | LGG | contains `fibrillary` | Low grade astrocytic tumor | LGG | Diffuse fibrillary astrocytoma, <subtype>
Low-grade glioma/astrocytoma (WHO grade I/II) | LGG | contains `gliomatosis cerebri, type 1, ia` | Low grade astrocytic tumor | LGG | Gliomatosis cerebri, <subtype>
Low-grade glioma/astrocytoma (WHO grade I/II) | LGG | contains `jpa` or `juvenile astrocytoma` or `pilocytic` or `pilocystic` (typo) or `pilomyxoid` but does not contain `fibrillary` | Low grade astrocytic tumor | LGG | Pilocytic astrocytoma, <subtype>
Low-grade glioma/astrocytoma (WHO grade I/II) | LGG | contains `oligodendroglioma who ii` | Diffuse astrocytic and oligodendroglial tumor | Oligodendroglioma | Oligodendroglioma, <subtype>
Low-grade glioma/astrocytoma (WHO grade I/II) | LGG | contains `pxa` or `pleomorphic xanthoastrocytoma` | Low grade astrocytic tumor | LGG | Pleomorphic xanthoastrocytoma, <subtype>

Additionally, `broad_histology`, `short_histology`, `integrated_diagnosis` and `harmonized_diagnosis` columns of tumors with following pathology diagnosis free text were updated as specified in the table below:

pathology_diagnosis | subtyping module | pathology_free_text_diagnosis | broad_histology | short_histology | integrated_diagnosis | harmonized_diagnosis 
-- | -- | -- | -- | -- | -- | -- 
Low-grade glioma/astrocytoma (WHO grade I/II) | NA, remove from LGG module | contains `desmoplastic infantile astrocytoma` | Neuronal and mixed neuronal-glial tumor | GNT | Desmoplastic infantile astrocytoma and ganglioglioma, <subtype> | Desmoplastic infantile astrocytoma and ganglioglioma 
Low-grade glioma/astrocytoma (WHO grade I/II) | NA, remove from LGG module | contains `diffuse leptomeningeal glioneuronal tumor` | Neuronal and mixed neuronal-glial tumor | GNT | Diffuse leptomeningeal glioneuronal tumor, <subtype> | Diffuse leptomeningeal glioneuronal tumor
Low-grade glioma/astrocytoma (WHO grade I/II) | NA, remove from LGG module | contains `glioneuronal` | Neuronal and mixed neuronal-glial tumor | GNT | Glial-neuronal tumor NOS, <subtype> | Glial-neuronal tumor NOS
Low-grade glioma/astrocytoma (WHO grade I/II) | NA, remove from LGG module | contains `rosette forming glioneuronal tumor` | Neuronal and mixed neuronal-glial tumor | GNT | Rosette-forming glioneuronal tumor, <subtype> | Rosette-forming glioneuronal tumor

Notes were also added to indicated that the changes in `broad_histology`, `short_histology`, `integrated_diagnosis` and `harmonized_diagnosis` were from pathology diagnosis free text.

For samples with subtype discrepancies, `molecular_subtype` and `integrated_diagnosis` were updated following pathology or clinical review.
Detailed information can be found in the analysis notebooks for [clinical](https://github.com/AlexsLemonade/OpenPBTA-analysis/blob/master/analyses/molecular-subtyping-pathology/03-incorporate-clinical-feedback.Rmd) and [pathology](https://github.com/AlexsLemonade/OpenPBTA-analysis/blob/master/analyses/molecular-subtyping-pathology/04-incorporate-pathology-feedback.Rmd) feedback.
Finally, the newly compiled subtypes were integrated into the `pbta-histologies.tsv` file in the `molecular-subtyping-integrate` module.


#### TP53 Alteration Annotation

In addition to tumor types mentioned above, TP53 altered status is also annotated for all samples and if a sample is determined to be either `TP53 loss` or `TP53 activated`, this annotation will be included in the `molecular_subtype` column. 
We applied a _TP53_ inactivation classifier originally trained on TCGA PanCan data [@doi:10.1016/j.celrep.2018.03.076] to the matched RNA expression data for each sample. 
Along with the _TP53_ classifier scores, consensus SNV and CNV, SV, and references databases that list TP53 hotspot mutations [@url:https://www.cancerhotspots.org/#/home; @doi:10.1158/2159-8290.CD-17-0321; @doi:10.1038/nbt.3391] and functional domains [@doi:10.1038/sj.cdd.4401904] were used collectively to determine TP53 alteration status for each sample.
The rules for calling either `TP53 loss` or `TP53 activated` are as follows:
If a sample has any of the two well-characterized _TP53_ gain-of-function mutations, p.R273C or p.R248W [@doi:10.1038/ng0593-42], `TP53 activated` status will be assigned.
A sample will be annotated as `TP53 loss` if any of the following conditions is met:
1) It contains a _TP53_ hotspot mutation as defined by IARC TP53 database [@url:https://www.cancerhotspots.org/#/home; @doi:10.1158/2159-8290.CD-17-0321; @doi:10.1038/nbt.3391] 
2) It contains two _TP53_ alterations, including SNV, CNV or SV, which is indicative of probable bi-allelic alterations
3) It contains one _TP53_ somatic alteration, including SNV, CNV, or SV and a germline _TP53_ mutation indicated by the diagnosis of Li-Fraumeni syndrome [@pmid:28270529]
4) It contains one germline _TP53_ mutation indicated by Li-Fraumeni syndrome and the _TP53_ classifier score for matched RNA-Seq is over 0.5. 

#### Survival analysis

Overall survival, denoted `OS_days`, was calculated as days since initial diagnosis.
Progression-free survival, denoted `PFS_days`, was calculated as days since last event.

#### Prediction of participants' genetic sex

Participant metadata includes a reported gender.
We used WGS germline data, in concert with the reported gender, to predict participant genetic sex so that we could identify sexually dimorphic outcomes.
This analysis may also reveal samples that may have been contaminated.
We used the `idxstats` utility from SAMtools [@pmid:19505943] to calculate read lengths, the number of mapped reads, and the corresponding chromosomal location for reads to the X and Y chromosomes.
We used the fraction of total normalized X and Y chromosome reads that were attributed to the Y chromosome as a summary statistic.
We reviewed this statistic in the context of reported gender and determined that a threshold of less than 0.2 clearly delineated female samples.
Fractions greater than 0.4 were predicted to be males.
Samples with values in the range [0.2, 0.4] were marked as unknown.
We ran this analysis through [CWL](https://github.com/d3b-center/sex-determination-tool) on CAVATICA.
Resulting calls were added to the histologies file as `germline_sex_estimate`.

#### Selection of independent samples

Certain analyses required that we select only a single representative specimen for each individual.
In these cases, we prioritized primary tumors and those with whole-genome sequencing available.
If this filtering still resulted in multiple specimens, we selected from the remaining set randomly.

#### Quantification of Telomerase Activity using Gene Expression Data

We predicted telomerase activity of tumor samples using the recently developed EXTEND method [@doi:https://doi.org/10.1101/2020.05.21.109249]. 
In brief, EXTEND estimates telomerase activity based on the expression of a 13-gene signature. 
This signature was derived by comparing telomerase positive tumors and tumors with activated alternative lengthening of telomeres pathway, a group presumably negative of telomerase activity. 

### ADDITIONAL RESOURCES
<!-- TODO: Add section -->

### KEY RESOURCES TABLE
| REAGENT or RESOURCE     | SOURCE                                | IDENTIFIER                                                                                   |                               
|-----------------|-------------------------------------------------|------------------------------------------------------------------------|
|Critical commercial assays|||
| Recover Cell Culture Freezing media    | Gibco           | 12648010    |
| Hank's Balanced Salt Solution (HBSS)   | Gibco           | 14175095    |
| Papain                                 | SciQuest        | LS003124    |
| Ovomucoid                              | SciQuest        | 542000      |
| DNase                                  | Roche           | 10104159001 |
| 100μm cell strainer                    | Greiner Bio-One | 542000      |
| DMEM/F-12 medium                       | Sigma           | D8062       |
| Fetal Bovine Serum (FBS)               | Hyclone         | SH30910.03  |
| GlutaMAX                               | Gibco           | 35050061    |
| Penicillin/Streptomycin-Amphotericin B | Lonza           | 17-745E     |
| Normocin                               | Invivogen       | ant-nr-2    |
| B-27 supplement minus vitamin A        | Gibco           | 12587-010   |
| N-2 supplement                         | Gibco           | 17502001    |
| Epidermal growth factor                | Gibco           | PHG0311L    |
| Basic fibroblast growth factor         | PeproTech       | 100-18B     |
| Heparin                                | Sigma           | H3149       |
| DNA/RNA AllPrep Kit                    | Qiagen          | 80204       |
| TruSeq RNA Sample Prep Kit             | Illumina        | FC-122-1001 |
| KAPA Library Preparation Kit           | Roche           | KK8201      |
| AllPrep DNA/RNA/miRNA Universal kit    | Qiagen          | 80224       |
| RNase A                                | Qiagen          | 19101       |
| QIAsymphony DSP DNA Midi Kit           | Qiagen          | 937255      |
| KAPA HyperPrep kit                     | Roche           | 08098107702      |
| RiboErase kit                          | Roche           | 07962304001      |
|Deposited data|||
|Raw and harmonized WGS, WXS, Panel, RNA-Seq                    |KidsFirst Data Resource Center, this project                        |[@doi:10.24370/OPENPBTA]                    |
|Merged summary files                    |this project                        |https://cavatica.sbgenomics.com/u/cavatica/openpbta                    |
|Merged summary files and downstream analyses                   |this project                        |https://github.com/AlexsLemonade/OpenPBTA-analysis/                    |
|Processed data                    |this project                        |https://pedcbioportal.kidsfirstdrc.org/study/summary?id=openpbta                   |
|Experimental models: Cell lines|||
|CBTN pediatric brain tumor-derived cell lines                    |[@doi:10.1093/neuonc/noz192]                        |See **Table S1** for identifiers                   |
|Software and algorithms|||
|Data processing and analysis software                    |Multiple                        |See **Table S4** for identifiers                    |
|OpenPBTA workflows repository                   |this project                        |[@doi:10.5281/zenodo.6363520]                    |
|OpenPBTA analysis repository                    |this project                        |                    |
|OpenPBTA manuscript repository                    |this project                        |                    |
|                    |                        |                    |
|Other|||
|TCGA WXS dataset                    |National Institutes of Health The Cancer Genome Atlas (TCGA)
                        |dbGAP phs000178.v11.p8                    |
|                    |                        |                    |
|                    |                        |                    |
|                    |                        |                    |
|                    |                        |                    |